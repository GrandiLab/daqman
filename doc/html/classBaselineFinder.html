<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>daqman: BaselineFinder Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<h1>BaselineFinder Class Reference</h1><!-- doxytag: class="BaselineFinder" --><!-- doxytag: inherits="ChannelModule" -->searches the beginning of a channel's waveform to determine baseline<p>
<a class="el" href="classBaseline.html">Baseline</a> finder searches for a (possibly) moving baseline DC offset in pulse data. It does this by taking a moving average (pre_samps before and post_samps after) for those points where the sample amplitude within the full average window is less than max_amplitude (or max_sum_amplitude)  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="BaselineFinder_8hh-source.html">BaselineFinder.hh</a>&gt;</code>
<p>
<p>Inheritance diagram for BaselineFinder:
<p><center><img src="classBaselineFinder.png" usemap="#BaselineFinder_map" border="0" alt=""></center>
<map name="BaselineFinder_map">
<area href="classChannelModule.html" alt="ChannelModule" shape="rect" coords="0,168,109,192">
<area href="classBaseModule.html" alt="BaseModule" shape="rect" coords="0,112,109,136">
<area href="classParameterList.html" alt="ParameterList" shape="rect" coords="0,56,109,80">
<area href="classVParameterNode.html" alt="VParameterNode" shape="rect" coords="0,0,109,24">
</map>
<a href="classBaselineFinder-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b661ab396f92e8169bafc3f307b4e9b9"></a><!-- doxytag: member="BaselineFinder::BaselineFinder" ref="b661ab396f92e8169bafc3f307b4e9b9" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#b661ab396f92e8169bafc3f307b4e9b9">BaselineFinder</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="19c742a8cf822a8b28576b4a58f2d20d"></a><!-- doxytag: member="BaselineFinder::~BaselineFinder" ref="19c742a8cf822a8b28576b4a58f2d20d" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#19c742a8cf822a8b28576b4a58f2d20d">~BaselineFinder</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b4855b672f6abd72610729931b18eeb1"></a><!-- doxytag: member="BaselineFinder::Initialize" ref="b4855b672f6abd72610729931b18eeb1" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#b4855b672f6abd72610729931b18eeb1">Initialize</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the module before starting a run. Return 0 if no error. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="80b91e4f20198f9e605f6f80c0ea9da9"></a><!-- doxytag: member="BaselineFinder::Finalize" ref="80b91e4f20198f9e605f6f80c0ea9da9" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#80b91e4f20198f9e605f6f80c0ea9da9">Finalize</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finalize state after a run has processed. Return 0 if no error. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b9a10e97e601c373caeeeeb0572859de"></a><!-- doxytag: member="BaselineFinder::Process" ref="b9a10e97e601c373caeeeeb0572859de" args="(ChannelData *chdata)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#b9a10e97e601c373caeeeeb0572859de">Process</a> (<a class="el" href="classChannelData.html">ChannelData</a> *chdata)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process a single channel in a single trigger. Return 0 if no error. <br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ceb4cf5aea27dce36cee788c4cab4600"></a><!-- doxytag: member="BaselineFinder::GetDefaultName" ref="ceb4cf5aea27dce36cee788c4cab4600" args="()" -->
static const std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#ceb4cf5aea27dce36cee788c4cab4600">GetDefaultName</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="96952dad77ed9529da7d4a55cf64764c"></a><!-- doxytag: member="BaselineFinder::fixed_baseline" ref="96952dad77ed9529da7d4a55cf64764c" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#96952dad77ed9529da7d4a55cf64764c">fixed_baseline</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4406ee5b737b410dd7b4165032158b58"></a><!-- doxytag: member="BaselineFinder::linear_interpolation" ref="4406ee5b737b410dd7b4165032158b58" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#4406ee5b737b410dd7b4165032158b58">linear_interpolation</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b2a912702f90df24c4e01a6abc0da31e"></a><!-- doxytag: member="BaselineFinder::segment_samps" ref="b2a912702f90df24c4e01a6abc0da31e" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#b2a912702f90df24c4e01a6abc0da31e">segment_samps</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f788b750d44f636766be279e71abb367"></a><!-- doxytag: member="BaselineFinder::min_valid_samps" ref="f788b750d44f636766be279e71abb367" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#f788b750d44f636766be279e71abb367">min_valid_samps</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ad48c3454107a46f8233c7ea92e13e32"></a><!-- doxytag: member="BaselineFinder::max_sigma" ref="ad48c3454107a46f8233c7ea92e13e32" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#ad48c3454107a46f8233c7ea92e13e32">max_sigma</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="6fa8e57b063a11748fdd992717a52611"></a><!-- doxytag: member="BaselineFinder::max_sigma_diff" ref="6fa8e57b063a11748fdd992717a52611" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#6fa8e57b063a11748fdd992717a52611">max_sigma_diff</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="36b2b8bdb8f89e84da23c8bc9c084c40"></a><!-- doxytag: member="BaselineFinder::max_mean_diff" ref="36b2b8bdb8f89e84da23c8bc9c084c40" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#36b2b8bdb8f89e84da23c8bc9c084c40">max_mean_diff</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b6d72a9d421cb125751b0f0f51ac3852"></a><!-- doxytag: member="BaselineFinder::avg_samps" ref="b6d72a9d421cb125751b0f0f51ac3852" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#b6d72a9d421cb125751b0f0f51ac3852">avg_samps</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0b3d4aaecb5025b72568543719dfe04c"></a><!-- doxytag: member="BaselineFinder::max_sigma_factor" ref="0b3d4aaecb5025b72568543719dfe04c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#0b3d4aaecb5025b72568543719dfe04c">max_sigma_factor</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4162867dd504282fc327c7d28a70bb3c"></a><!-- doxytag: member="BaselineFinder::pulse_threshold" ref="4162867dd504282fc327c7d28a70bb3c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#4162867dd504282fc327c7d28a70bb3c">pulse_threshold</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="2ce051ed8ca4d2e63de91d9629ebbc98"></a><!-- doxytag: member="BaselineFinder::cooldown" ref="2ce051ed8ca4d2e63de91d9629ebbc98" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#2ce051ed8ca4d2e63de91d9629ebbc98">cooldown</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5726b6c7fb882cb58e74c96c3ad9786a"></a><!-- doxytag: member="BaselineFinder::pre_cooldown" ref="5726b6c7fb882cb58e74c96c3ad9786a" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#5726b6c7fb882cb58e74c96c3ad9786a">pre_cooldown</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c01ec88cb1b833995bc77a1800ffae99"></a><!-- doxytag: member="BaselineFinder::max_amplitude" ref="c01ec88cb1b833995bc77a1800ffae99" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#c01ec88cb1b833995bc77a1800ffae99">max_amplitude</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">max amplitude for sample to be part of baseline <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0c1065ff26b5e5cd984b9842f7f427b"></a><!-- doxytag: member="BaselineFinder::max_sum_amplitude" ref="a0c1065ff26b5e5cd984b9842f7f427b" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#a0c1065ff26b5e5cd984b9842f7f427b">max_sum_amplitude</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">max_amplitude for sum channel <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="92cd50ab779a6d41708abf178489d619"></a><!-- doxytag: member="BaselineFinder::signal_begin_time" ref="92cd50ab779a6d41708abf178489d619" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#92cd50ab779a6d41708abf178489d619">signal_begin_time</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">position to start searching for baseline <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c5d15932f35e4b4d03142e39a7e8eb3a"></a><!-- doxytag: member="BaselineFinder::pre_samps" ref="c5d15932f35e4b4d03142e39a7e8eb3a" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#c5d15932f35e4b4d03142e39a7e8eb3a">pre_samps</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">samples before point to average <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="fc32515e059bd2e923b1342b3b1cb07d"></a><!-- doxytag: member="BaselineFinder::post_samps" ref="fc32515e059bd2e923b1342b3b1cb07d" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#fc32515e059bd2e923b1342b3b1cb07d">post_samps</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">samples after point to average <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="21e7b1749f687374413cd957a65a1817"></a><!-- doxytag: member="BaselineFinder::save_interpolations" ref="21e7b1749f687374413cd957a65a1817" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#21e7b1749f687374413cd957a65a1817">save_interpolations</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Save drift baseline interpolation regions as spe. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b0b26f7ec6dea03bdd1d58624457598c"></a><!-- doxytag: member="BaselineFinder::laserwindow_begin_time" ref="b0b26f7ec6dea03bdd1d58624457598c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#b0b26f7ec6dea03bdd1d58624457598c">laserwindow_begin_time</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="25a1749721f521be9ee8449480fbce5c"></a><!-- doxytag: member="BaselineFinder::laserwindow_end_time" ref="25a1749721f521be9ee8449480fbce5c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#25a1749721f521be9ee8449480fbce5c">laserwindow_end_time</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="43e7390e9c7e843b620c5fcc7fa0c330"></a><!-- doxytag: member="BaselineFinder::laserwindow_freeze" ref="43e7390e9c7e843b620c5fcc7fa0c330" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#43e7390e9c7e843b620c5fcc7fa0c330">laserwindow_freeze</a></td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9f946466576a117b39cee01003ab4ee9"></a><!-- doxytag: member="BaselineFinder::FixedBaseline" ref="9f946466576a117b39cee01003ab4ee9" args="(ChannelData *chdata)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#9f946466576a117b39cee01003ab4ee9">FixedBaseline</a> (<a class="el" href="classChannelData.html">ChannelData</a> *chdata)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#0802ec23f2f99ee38d22e281686375e3">DriftingBaseline</a> (<a class="el" href="classChannelData.html">ChannelData</a> *chdata)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
searches the beginning of a channel's waveform to determine baseline<p>
<a class="el" href="classBaseline.html">Baseline</a> finder searches for a (possibly) moving baseline DC offset in pulse data. It does this by taking a moving average (pre_samps before and post_samps after) for those points where the sample amplitude within the full average window is less than max_amplitude (or max_sum_amplitude) 
<p>
The algorithm goes: 1) Find the highest sample in the time before signal_begin_time 2) search for a region which is pre_samps+post_samps long which has no sample below the max found in the last step - 2*max_amplitude Call this the original baseline. If no clean region is found before signal_begin_time, we fail and abort 3) Once a first guess at baseline is found, call that moving_base. From then on, the baseline is evaluated if all samples in a window are within max_amplitude of the last evaluated moving baseline. 4) For samples of large amplitude, the baseline is linearly interpolated from the nearest good points. 5) Finally we subtract the moving baseline from the signal and store it in the subtracted_waveform 
<p>

<p>
Definition at line <a class="el" href="BaselineFinder_8hh-source.html#l00036">36</a> of file <a class="el" href="BaselineFinder_8hh-source.html">BaselineFinder.hh</a>.<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="0802ec23f2f99ee38d22e281686375e3"></a><!-- doxytag: member="BaselineFinder::DriftingBaseline" ref="0802ec23f2f99ee38d22e281686375e3" args="(ChannelData *chdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BaselineFinder::DriftingBaseline           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classChannelData.html">ChannelData</a> *&nbsp;</td>
          <td class="paramname"> <em>chdata</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="BaselineFinder_8cc-source.html#l00093">93</a> of file <a class="el" href="BaselineFinder_8cc-source.html">BaselineFinder.cc</a>.
</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>modules/include/<a class="el" href="BaselineFinder_8hh-source.html">BaselineFinder.hh</a><li>modules/src/<a class="el" href="BaselineFinder_8cc-source.html">BaselineFinder.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Tue Jun 25 13:42:54 2013 for daqman by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
