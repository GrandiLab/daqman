<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>daqman: BaselineFinder Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>BaselineFinder Class Reference<br/>
<small>
[<a class="el" href="group__modules.html">modules - functions to process raw data in series</a>]</small>
</h1><!-- doxytag: class="BaselineFinder" --><!-- doxytag: inherits="ChannelModule" -->
<p>searches the beginning of a channel's waveform to determine baseline<a class="el" href="classBaseline.html" title="Variables related to the found baseline for a channel.">Baseline</a> finder searches for a (possibly) moving baseline DC offset in pulse data. It does this by taking a moving average (pre_samps before and post_samps after) for those points where the sample amplitude within the full average window is less than max_amplitude (or max_sum_amplitude)  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="BaselineFinder_8hh_source.html">BaselineFinder.hh</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BaselineFinder:</div>
<div class="dynsection">
 <div class="center">
  <img src="classBaselineFinder.gif" usemap="#BaselineFinder_map" alt=""/>
  <map id="BaselineFinder_map" name="BaselineFinder_map">
<area href="classChannelModule.html" alt="ChannelModule" shape="rect" coords="0,168,109,192"/>
<area href="classBaseModule.html" alt="BaseModule" shape="rect" coords="0,112,109,136"/>
<area href="classParameterList.html" alt="ParameterList" shape="rect" coords="0,56,109,80"/>
<area href="classVParameterNode.html" alt="VParameterNode" shape="rect" coords="0,0,109,24"/>
</map>
 </div>
</div>

<p><a href="classBaselineFinder-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab4855b672f6abd72610729931b18eeb1"></a><!-- doxytag: member="BaselineFinder::Initialize" ref="ab4855b672f6abd72610729931b18eeb1" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#ab4855b672f6abd72610729931b18eeb1">Initialize</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the module before starting a run. Return 0 if no error. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a80b91e4f20198f9e605f6f80c0ea9da9"></a><!-- doxytag: member="BaselineFinder::Finalize" ref="a80b91e4f20198f9e605f6f80c0ea9da9" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#a80b91e4f20198f9e605f6f80c0ea9da9">Finalize</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finalize state after a run has processed. Return 0 if no error. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab9a10e97e601c373caeeeeb0572859de"></a><!-- doxytag: member="BaselineFinder::Process" ref="ab9a10e97e601c373caeeeeb0572859de" args="(ChannelData *chdata)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#ab9a10e97e601c373caeeeeb0572859de">Process</a> (<a class="el" href="classChannelData.html">ChannelData</a> *chdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process a single channel in a single trigger. Return 0 if no error. <br/></td></tr>
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aceb4cf5aea27dce36cee788c4cab4600"></a><!-- doxytag: member="BaselineFinder::GetDefaultName" ref="aceb4cf5aea27dce36cee788c4cab4600" args="()" -->
static const std::string&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetDefaultName</b> ()</td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a96952dad77ed9529da7d4a55cf64764c"></a><!-- doxytag: member="BaselineFinder::fixed_baseline" ref="a96952dad77ed9529da7d4a55cf64764c" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><b>fixed_baseline</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4406ee5b737b410dd7b4165032158b58"></a><!-- doxytag: member="BaselineFinder::linear_interpolation" ref="a4406ee5b737b410dd7b4165032158b58" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><b>linear_interpolation</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab2a912702f90df24c4e01a6abc0da31e"></a><!-- doxytag: member="BaselineFinder::segment_samps" ref="ab2a912702f90df24c4e01a6abc0da31e" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>segment_samps</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af788b750d44f636766be279e71abb367"></a><!-- doxytag: member="BaselineFinder::min_valid_samps" ref="af788b750d44f636766be279e71abb367" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>min_valid_samps</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aad48c3454107a46f8233c7ea92e13e32"></a><!-- doxytag: member="BaselineFinder::max_sigma" ref="aad48c3454107a46f8233c7ea92e13e32" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>max_sigma</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6fa8e57b063a11748fdd992717a52611"></a><!-- doxytag: member="BaselineFinder::max_sigma_diff" ref="a6fa8e57b063a11748fdd992717a52611" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>max_sigma_diff</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a36b2b8bdb8f89e84da23c8bc9c084c40"></a><!-- doxytag: member="BaselineFinder::max_mean_diff" ref="a36b2b8bdb8f89e84da23c8bc9c084c40" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>max_mean_diff</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab6d72a9d421cb125751b0f0f51ac3852"></a><!-- doxytag: member="BaselineFinder::avg_samps" ref="ab6d72a9d421cb125751b0f0f51ac3852" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>avg_samps</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0b3d4aaecb5025b72568543719dfe04c"></a><!-- doxytag: member="BaselineFinder::max_sigma_factor" ref="a0b3d4aaecb5025b72568543719dfe04c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>max_sigma_factor</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4162867dd504282fc327c7d28a70bb3c"></a><!-- doxytag: member="BaselineFinder::pulse_threshold" ref="a4162867dd504282fc327c7d28a70bb3c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>pulse_threshold</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ce051ed8ca4d2e63de91d9629ebbc98"></a><!-- doxytag: member="BaselineFinder::cooldown" ref="a2ce051ed8ca4d2e63de91d9629ebbc98" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>cooldown</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5726b6c7fb882cb58e74c96c3ad9786a"></a><!-- doxytag: member="BaselineFinder::pre_cooldown" ref="a5726b6c7fb882cb58e74c96c3ad9786a" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>pre_cooldown</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac01ec88cb1b833995bc77a1800ffae99"></a><!-- doxytag: member="BaselineFinder::max_amplitude" ref="ac01ec88cb1b833995bc77a1800ffae99" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#ac01ec88cb1b833995bc77a1800ffae99">max_amplitude</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">max amplitude for sample to be part of baseline <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa0c1065ff26b5e5cd984b9842f7f427b"></a><!-- doxytag: member="BaselineFinder::max_sum_amplitude" ref="aa0c1065ff26b5e5cd984b9842f7f427b" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#aa0c1065ff26b5e5cd984b9842f7f427b">max_sum_amplitude</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">max_amplitude for sum channel <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a92cd50ab779a6d41708abf178489d619"></a><!-- doxytag: member="BaselineFinder::signal_begin_time" ref="a92cd50ab779a6d41708abf178489d619" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#a92cd50ab779a6d41708abf178489d619">signal_begin_time</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">position to start searching for baseline <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac5d15932f35e4b4d03142e39a7e8eb3a"></a><!-- doxytag: member="BaselineFinder::pre_samps" ref="ac5d15932f35e4b4d03142e39a7e8eb3a" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#ac5d15932f35e4b4d03142e39a7e8eb3a">pre_samps</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">samples before point to average <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc32515e059bd2e923b1342b3b1cb07d"></a><!-- doxytag: member="BaselineFinder::post_samps" ref="afc32515e059bd2e923b1342b3b1cb07d" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#afc32515e059bd2e923b1342b3b1cb07d">post_samps</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">samples after point to average <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a21e7b1749f687374413cd957a65a1817"></a><!-- doxytag: member="BaselineFinder::save_interpolations" ref="a21e7b1749f687374413cd957a65a1817" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#a21e7b1749f687374413cd957a65a1817">save_interpolations</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Save drift baseline interpolation regions as spe. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab0b26f7ec6dea03bdd1d58624457598c"></a><!-- doxytag: member="BaselineFinder::laserwindow_begin_time" ref="ab0b26f7ec6dea03bdd1d58624457598c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>laserwindow_begin_time</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a25a1749721f521be9ee8449480fbce5c"></a><!-- doxytag: member="BaselineFinder::laserwindow_end_time" ref="a25a1749721f521be9ee8449480fbce5c" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>laserwindow_end_time</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a43e7390e9c7e843b620c5fcc7fa0c330"></a><!-- doxytag: member="BaselineFinder::laserwindow_freeze" ref="a43e7390e9c7e843b620c5fcc7fa0c330" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><b>laserwindow_freeze</b></td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9f946466576a117b39cee01003ab4ee9"></a><!-- doxytag: member="BaselineFinder::FixedBaseline" ref="a9f946466576a117b39cee01003ab4ee9" args="(ChannelData *chdata)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>FixedBaseline</b> (<a class="el" href="classChannelData.html">ChannelData</a> *chdata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaselineFinder.html#a0802ec23f2f99ee38d22e281686375e3">DriftingBaseline</a> (<a class="el" href="classChannelData.html">ChannelData</a> *chdata)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>searches the beginning of a channel's waveform to determine baseline</p>
<p><a class="el" href="classBaseline.html" title="Variables related to the found baseline for a channel.">Baseline</a> finder searches for a (possibly) moving baseline DC offset in pulse data. It does this by taking a moving average (pre_samps before and post_samps after) for those points where the sample amplitude within the full average window is less than max_amplitude (or max_sum_amplitude) </p>
<p>The algorithm goes: 1) Find the highest sample in the time before signal_begin_time 2) search for a region which is pre_samps+post_samps long which has no sample below the max found in the last step - 2*max_amplitude Call this the original baseline. If no clean region is found before signal_begin_time, we fail and abort 3) Once a first guess at baseline is found, call that moving_base. From then on, the baseline is evaluated if all samples in a window are within max_amplitude of the last evaluated moving baseline. 4) For samples of large amplitude, the baseline is linearly interpolated from the nearest good points. 5) Finally we subtract the moving baseline from the signal and store it in the subtracted_waveform </p>

<p>Definition at line <a class="el" href="BaselineFinder_8hh_source.html#l00036">36</a> of file <a class="el" href="BaselineFinder_8hh_source.html">BaselineFinder.hh</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a0802ec23f2f99ee38d22e281686375e3"></a><!-- doxytag: member="BaselineFinder::DriftingBaseline" ref="a0802ec23f2f99ee38d22e281686375e3" args="(ChannelData *chdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BaselineFinder::DriftingBaseline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classChannelData.html">ChannelData</a> *&nbsp;</td>
          <td class="paramname"> <em>chdata</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>pass_amp </p>
</p>

<p>Definition at line <a class="el" href="BaselineFinder_8cc_source.html#l00093">93</a> of file <a class="el" href="BaselineFinder_8cc_source.html">BaselineFinder.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>modules/include/<a class="el" href="BaselineFinder_8hh_source.html">BaselineFinder.hh</a></li>
<li>modules/src/<a class="el" href="BaselineFinder_8cc_source.html">BaselineFinder.cc</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 20 Jun 2014 for daqman by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
